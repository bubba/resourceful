\chapter{Evaluation} \label{chapter:evaluation}


\begin{grammar}

  <type $\tau$> ::= () | $\tau \rightarrow \tau'$ | $\tau \times \tau'$ | $\textsf{IO}_\sigma \tau$
  
  <type scheme $\sigma$> ::= $\forall \alpha . \sigma$ | $\tau$

  <expression $e$> ::= () | $e \times e'$
  \alt $x$ | $\lambda x . e$ | $e \ e'$ | $\letin{x = e}{e'}$
  \alt $\textsf{if} \ e_1 \ \textsf{then} \ e_2 \ \textsf{else} \ e_3$
  \alt $\lift{e}$ | $\lift{e}_\sigma$ | $e \bind e'$ | $e \curlyvee e'$

  <resource $\rho$> ::= $r$ | \textsf{World}

  <heap $\sigma$> ::= $\rho$ | $\sigma \cup \sigma'$

\end{grammar}

\begin{figure}
  \begin{mathpar}
    \inferrule*[Right=Var]{x : \tau' \in \Gamma \\ \tau' > \tau}{\Gamma \vdash x : \tau} \and
    \inferrule*[Right=App]{\Gamma \vdash e : \tau' \rightarrow \tau \\ \Gamma \vdash e' : \tau'}{\Gamma \vdash e \ e' : \tau} \and
    \inferrule*[Right=Abs]{\Gamma,x : \tau \vdash e : \tau'} {\Gamma \vdash \lambda x . \ e : \tau \rightarrow
      \tau'} \and
    \inferrule*[Right=Let]{\Gamma \vdash e : \tau \\ \Gamma,x : \bar{\Gamma}(\tau) \vdash e' : \tau'}
    {\Gamma \vdash \mathsf{let} \ x = e \ \mathsf{in} \ e' : \tau'} \and
    \inferrule*[Right=If]{\Gamma \vdash e_1 : \mathbf{Bool} \\ \Gamma \vdash e_2 : \tau \\ \Gamma \vdash e_3 : \tau}
                         {\Gamma \vdash \mathsf{if} \ e_1 \ \mathsf{then} \ e_2 \ \mathsf{else} \
                           e_3 : \tau} \and


    \inferrule*[Right=Product]{\Gamma \vdash e : \tau \\ \Gamma \vdash e' : \tau'}
    {\Gamma \vdash e \times e' : \tau \times \tau'} \and

    \inferrule*[Right=Lift]{\Gamma \vdash e : \tau}{\Gamma \vdash \llbracket e \rrbracket : \IO_\sigma \tau} \and
    \inferrule*[Right=Bind]{\Gamma \vdash e : \IO_\sigma \tau' \\ \Gamma \vdash e' : \tau' \rightarrow \IO_\sigma
      \tau}{\Gamma \vdash e \bind e' : \IO_\sigma \tau} \and
    \inferrule*[Right=Conc]{\Gamma \vdash e_1 : \IO_\sigma \tau_1 \\ \Gamma \vdash e_2 : \IO_{\sigma'}
      \tau_2 \\
      \sigma \notsubtyp \sigma' \\ \sigma' \notsubtyp \sigma}
    {\Gamma \vdash e_1 \curlyvee e_2 : \IO_{\sigma \cup \sigma'} \ \tau_1 \times \tau_2} \and

    
    \inferrule*[Right=Tag]{ }{\Gamma \vdash \mathsf{readFile} : \IO_{\mathsf{File}} ()} \and
    \inferrule*[Right=ReadNet]{ }{\Gamma \vdash \mathsf{readNet} : \IO_{\mathsf{Net}} ()} \and

    \inferrule*[Right=Subsumption]{\Gamma \vdash e : \IO_\sigma \tau \\ \sigma \subtyp \sigma'}
    {\Gamma \vdash e : \IO_{\sigma'} \tau} \and
    \inferrule*[Right=Unit]{ }{\Gamma \vdash () : ()} \and
    \inferrule*[Right=True]{ }{\Gamma \vdash \textsf{True} : \textsf{Bool}} \and
    \inferrule*[Right=False]{ }{\Gamma \vdash \textsf{False} : \textsf{Bool}}
  \end{mathpar}

  \caption{Typing rules}
\end{figure}
%%% Local Variables:
%%% TeX-master: "report"
%%% TeX-engine: luatex
%%% TeX-command-extra-options: "-shell-escape"
%%% End:
